<h1>Complete Payment</h1>

<select id="plan">
<option value="100">2 Days — KSh 100</option>
<option value="400">Weekly — KSh 400</option>
<option value="1200">Monthly — KSh 1200</option>
</select>

<button onclick="pay()">Pay Now</button>
<script type="module">

import { auth, db } from "./firebase.js";
import { doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

window.pay = async function(){

  let user = auth.currentUser;

  if(!user){
    alert("Login first");
    return;
  }

  let price = document.getElementById("plan").value;

  let days = price == 100 ? 2 :
             price == 400 ? 7 : 30;

  let expiry = new Date();
  expiry.setDate(expiry.getDate()+days);

  await updateDoc(doc(db,"users",user.uid),{
    subscription:{
      plan: price,
      expiry: expiry.toISOString()
    }
  });

  alert("Subscription activated");
  window.location.href="dashboard.html";
}

</script>

<script>

function pay(){

  let price = document.getElementById("plan").value;

  alert("Processing payment of KSh " + price);

  setTimeout(()=>{
    alert("Payment successful");
    window.location.href="dashboard.html";
  },2000);

}

</script>
<form action="/payment/stk" method="POST">
  <input name="phone" placeholder="Your phone" required>
  <button>Pay & Unlock</button>
</form>
